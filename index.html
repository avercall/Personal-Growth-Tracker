<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Growth Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD4IYJo_cNRILK3KmmDExpmuO7F4c_izN4",
    authDomain: "growth-tracker-a367c.firebaseapp.com",
    projectId: "growth-tracker-a367c",
    storageBucket: "growth-tracker-a367c.firebasestorage.app",
    messagingSenderId: "277469925642",
    appId: "1:277469925642:web:f79c6f277931c969bfaaf3",
    measurementId: "G-DPYPWBMHLB"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth();
  const db = getFirestore();
  window.firebaseAuth = auth;
  window.firebaseDB = db;
</script>
<style>
body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
.container { max-width: 900px; }
.card {
    background-color: white;
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    padding: 1.5rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover { transform: translateY(-5px); box-shadow: 0 15px 20px -5px rgba(0,0,0,0.1),0 6px 8px -3px rgba(0,0,0,0.05);}
input[type="number"] { -moz-appearance: textfield; text-align: center; }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
</style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
<div class="container mx-auto p-4 md:p-8" id="main-container">

    <!-- Authentication Section -->
    <div id="auth-section" class="card text-center mb-6">
        <h1 class="text-2xl font-bold mb-4">Sign In</h1>
        <button id="google-signin-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg mb-2 hover:bg-blue-600">Sign in with Google</button>
        <div class="mb-2">OR</div>
        <input type="email" id="email-input" placeholder="Email" class="border p-2 rounded mb-2 w-full">
        <input type="password" id="password-input" placeholder="Password" class="border p-2 rounded mb-2 w-full">
        <div class="flex justify-between">
            <button id="email-signup-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded hover:bg-green-600">Sign Up</button>
            <button id="email-signin-btn" class="bg-indigo-500 text-white font-bold py-2 px-4 rounded hover:bg-indigo-600">Sign In</button>
        </div>
    </div>

    <!-- Tracker UI (hidden until auth) -->
    <div id="tracker-ui" class="hidden">

        <div class="flex justify-end mb-4">
            <button id="signout-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded hover:bg-red-600">Sign Out</button>
        </div>

        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6">Personal Growth Tracker</h1>

        <!-- Daily Tracker Section -->
        <div class="card mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">Daily Tracker</h2>
            <div id="tracker-table-container" class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Prayer</th>
                            <th>Mindset</th>
                            <th>Prioritize</th>
                            <th>Visualize</th>
                            <th>Exercise</th>
                            <th>Tracking</th>
                            <th>Habit Slips</th>
                            <th>Job Hours</th>
                            <th>Impact Hours</th>
                            <th>Daily Score</th>
                        </tr>
                    </thead>
                    <tbody id="tracker-tbody"></tbody>
                </table>
            </div>
            <div class="mt-4 text-center">
                <button id="add-day-btn" class="bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-600 active:scale-95 transition duration-300">Add Day</button>
            </div>
        </div>

        <!-- Prioritization Checklist Section -->
        <div class="card mt-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-2 text-center">Prioritization Checklist</h2>
            <div id="prioritization-list" class="space-y-4">
                <div class="flex items-center space-x-2">
                    <input type="checkbox" class="task-checkbox">
                    <input type="text" class="task-input flex-1 border-b border-gray-300 focus:outline-none p-1" placeholder="Task 1">
                </div>
                <div class="flex items-center space-x-2">
                    <input type="checkbox" class="task-checkbox">
                    <input type="text" class="task-input flex-1 border-b border-gray-300 focus:outline-none p-1" placeholder="Task 2">
                </div>
                <div class="flex items-center space-x-2">
                    <input type="checkbox" class="task-checkbox">
                    <input type="text" class="task-input flex-1 border-b border-gray-300 focus:outline-none p-1" placeholder="Task 3">
                </div>
            </div>
        </div>

        <!-- Timers Section -->
        <div class="card mt-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">Timers</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Job Hours Timer -->
                <div class="text-center">
                    <h3 class="text-lg font-bold text-gray-700 mb-2">Job Hours</h3>
                    <p id="job-timer-display" class="text-3xl font-mono text-gray-800 mb-4">00:00:00</p>
                    <div class="flex justify-center space-x-4">
                        <button id="job-start-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 active:scale-95 transition duration-300">Start</button>
                        <button id="job-stop-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 active:scale-95 transition duration-300">Stop</button>
                        <button id="job-log-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 active:scale-95 transition duration-300">Log</button>
                    </div>
                </div>
                <!-- Impact Hours Timer -->
                <div class="text-center">
                    <h3 class="text-lg font-bold text-gray-700 mb-2">Impact Hours</h3>
                    <p id="impact-timer-display" class="text-3xl font-mono text-gray-800 mb-4">00:00:00</p>
                    <div class="flex justify-center space-x-4">
                        <button id="impact-start-btn" class="bg-green-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-600 active:scale-95 transition duration-300">Start</button>
                        <button id="impact-stop-btn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600 active:scale-95 transition duration-300">Stop</button>
                        <button id="impact-log-btn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 active:scale-95 transition duration-300">Log</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Habit Breaking Section -->
        <div class="card mt-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-700 text-center">Habit Breaking</h2>
                <button id="add-habit-btn" class="bg-green-500 text-white text-sm font-bold py-1 px-3 rounded-lg hover:bg-green-600 active:scale-95 transition duration-300">Add Habit</button>
            </div>
            <div id="habit-breaking-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </div>

        <!-- Growth Level, Level Up Streak, Weekly Total -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6 mb-6">
            <div class="card text-center">
                <h2 class="text-lg font-bold text-gray-700 mb-2">Weekly Total</h2>
                <p id="weekly-total" class="text-4xl font-extrabold text-indigo-600">0</p>
            </div>
            <div class="card text-center">
                <h2 class="text-lg font-bold text-gray-700 mb-2">Growth Level <button id="explain-level-btn" class="text-sm text-indigo-500 hover:text-indigo-700 font-normal active:scale-95 transition duration-300">What's this? ✨</button></h2>
                <p id="crusade-level" class="text-2xl font-bold text-teal-600">Below Growth Level One</p>
                <p id="level-explanation" class="text-xs text-gray-500 mt-2 italic hidden"></p>
            </div>
            <div class="card text-center">
                <h2 class="text-lg font-bold text-gray-700 mb-2">Level Up Streak</h2>
                <p id="level-streak" class="text-4xl font-extrabold text-blue-600">0</p>
            </div>
        </div>

        <!-- Charts -->
        <div class="card mt-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-2 text-center">Daily Progress Chart</h2>
            <canvas id="dailyChart" class="bg-gray-50 rounded-lg p-2"></canvas>
        </div>
        <div class="card mt-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-2 text-center">Weekly Progress Chart</h2>
            <canvas id="weeklyChart" class="bg-gray-50 rounded-lg p-2"></canvas>
        </div>

        <!-- Insights Section -->
        <div class="card mt-6 mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">Insights</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="text-center">
                    <h3 class="text-lg font-bold text-gray-700 mb-2">Daily Reflection</h3>
                    <button id="reflection-btn" class="w-full bg-purple-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-600 active:scale-95 transition duration-300">Generate ✨</button>
                    <p id="reflection-output" class="mt-4 text-gray-700 italic text-sm"></p>
                </div>
                <div class="text-center">
                    <h3 class="text-lg font-bold text-gray-700 mb-2">Weekly Summary</h3>
                    <button id="weekly-summary-btn" class="w-full bg-orange-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-600 active:scale-95 transition duration-300">Generate ✨</button>
                    <p id="weekly-summary-output" class="mt-4 text-gray-700 italic text-sm"></p>
                </div>
            </div>
        </div>

    </div>
</div>

<script type="module">
import { firebaseAuth, firebaseDB } from './firebase.js'; // Already initialized above

document.addEventListener('DOMContentLoaded', () => {

    const authSection = document.getElementById('auth-section');
    const trackerUI = document.getElementById('tracker-ui');

    const googleBtn = document.getElementById('google-signin-btn');
    const emailSignUpBtn = document.getElementById('email-signup-btn');
    const emailSignInBtn = document.getElementById('email-signin-btn');
    const signOutBtn = document.getElementById('signout-btn');

    const emailInput = document.getElementById('email-input');
    const passwordInput = document.getElementById('password-input');

    // Sign in state listener
    onAuthStateChanged(firebaseAuth, user => {
        if(user){
            authSection.style.display = 'none';
            trackerUI.style.display = 'block';
        } else {
            authSection.style.display = 'block';
            trackerUI.style.display = 'none';
        }
    });

    // Google Sign-In
    googleBtn.addEventListener('click', () => {
        const provider = new GoogleAuthProvider();
        signInWithPopup(firebaseAuth, provider).catch(console.error);
    });

    // Email Sign-Up
    emailSignUpBtn.addEventListener('click', () => {
        createUserWithEmailAndPassword(firebaseAuth, emailInput.value, passwordInput.value).catch(console.error);
    });

    // Email Sign-In
    emailSignInBtn.addEventListener('click', () => {
        signInWithEmailAndPassword(firebaseAuth, emailInput.value, passwordInput.value).catch(console.error);
    });

    // Sign Out
    signOutBtn.addEventListener('click', () => signOut(firebaseAuth));

    // ------------------------------
    // Daily Tracker Logic
    // ------------------------------
    const addDayBtn = document.getElementById('add-day-btn');
    const trackerTbody = document.getElementById('tracker-tbody');

    function createDayRow(){
        const tr = document.createElement('tr');
        const today = new Date().toISOString().split('T')[0];

        tr.innerHTML = `
            <td>${today}</td>
            <td><input type="checkbox" class="daily-checkbox" data-points="1"></td>
            <td><input type="checkbox" class="daily-checkbox" data-points="1"></td>
            <td><input type="checkbox" class="daily-checkbox prioritize-box" data-points="1"></td>
            <td><input type="checkbox" class="daily-checkbox" data-points="1"></td>
            <td><input type="checkbox" class="daily-checkbox exercise-box" data-points="3"></td>
            <td><input type="checkbox" class="daily-checkbox tracking-box" data-points="3"></td>
            <td><input type="number" class="habit-slips" value="0"></td>
            <td><input type="number" class="job-hours" value="0"></td>
            <td><input type="number" class="impact-hours" value="0"></td>
            <td class="daily-score">0</td>
        `;

        trackerTbody.appendChild(tr);
        attachDailyEvents(tr);
    }

    function attachDailyEvents(tr){
        const checkboxes = tr.querySelectorAll('.daily-checkbox');
        const exerciseBox = tr.querySelector('.exercise-box');
        const trackingBox = tr.querySelector('.tracking-box');
        const habitSlips = tr.querySelector('.habit-slips');
        const jobHours = tr.querySelector('.job-hours');
        const impactHours = tr.querySelector('.impact-hours');
        const scoreCell = tr.querySelector('.daily-score');

        function updateScore(){
            let score = 0;
            checkboxes.forEach(cb => { if(cb.checked) score += parseInt(cb.dataset.points); });
            score -= parseInt(habitSlips.value || 0);
            score += parseInt(jobHours.value || 0);
            score += parseInt(impactHours.value || 0)*3;
            scoreCell.textContent = score;
            updateCharts();
        }

        checkboxes.forEach(cb => cb.addEventListener('change', () => {
            updateScore();
            if(cb !== trackingBox) trackingBox.checked = true;
            updateScore();
        }));

        habitSlips.addEventListener('input', updateScore);
        jobHours.addEventListener('input', updateScore);
        impactHours.addEventListener('input', updateScore);
    }

    addDayBtn.addEventListener('click', createDayRow);

    // ------------------------------
    // Charts
    // ------------------------------
    const dailyCtx = document.getElementById('dailyChart').getContext('2d');
    const weeklyCtx = document.getElementById('weeklyChart').getContext('2d');

    const dailyChart = new Chart(dailyCtx, { type:'bar', data:{ labels:[], datasets:[{ label:'Daily Score', data:[], backgroundColor:'#6366f1'}] }, options:{ responsive:true } });
    const weeklyChart = new Chart(weeklyCtx, { type:'line', data:{ labels:[], datasets:[{ label:'Weekly Score', data:[], borderColor:'#10b981', fill:false }] }, options:{ responsive:true } });

    function updateCharts(){
        const rows = trackerTbody.querySelectorAll('tr');
        const dailyLabels = [], dailyData = [];
        let weeklySum = 0;

        rows.forEach((r,i)=>{
            const date = r.children[0].textContent;
            const score = parseInt(r.querySelector('.daily-score').textContent);
            dailyLabels.push(date);
            dailyData.push(score);
            weeklySum += score;
        });

        dailyChart.data.labels = dailyLabels;
        dailyChart.data.datasets[0].data = dailyData;
        dailyChart.update();

        weeklyChart.data.labels = dailyLabels;
        weeklyChart.data.datasets[0].data = dailyData;
        weeklyChart.update();

        document.getElementById('weekly-total').textContent = weeklySum;
    }

});
</script>
</body>
</html>
