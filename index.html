<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Growth Tracker</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:sans-serif;margin:0;padding:0;background:#f2f2f2;}
.card{background:white;padding:20px;margin:15px auto;width:90%;max-width:1000px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.card h2{text-align:center;margin-bottom:10px;}
.input-group{text-align:center;margin-bottom:10px;}
input[type="text"], input[type="email"], input[type="password"]{display:block;margin:10px auto;padding:8px;width:80%;max-width:300px;text-align:center;}
button{padding:5px 10px;border:none;border-radius:6px;background:#007bff;color:white;margin:2px;cursor:pointer;}
button:hover{opacity:0.9;}
#logoutBtn{position:absolute;top:10px;right:10px;}
section{margin-bottom:20px;}
table{border-collapse:collapse;width:100%;}
th,td{text-align:center;padding:5px;border:1px solid #ccc;}
.high-score{background:#b6fcb6;}
.low-score{background:#fcb6b6;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-card" class="card">
  <h2>Login / Signup</h2>
  <div class="input-group">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Signup</button>
  </div>
  <p id="loginError" style="color:red;text-align:center"></p>
</div>

<!-- APP -->
<div id="app" style="display:none; position:relative;">
<button id="logoutBtn">Logout</button>

<!-- DAILY TRACKER -->
<section class="card">
<h2>Daily Tracker</h2>
<button id="addDayBtn">Add Today</button>
<p id="weeklyFeedback"></p>
<table>
<thead>
<tr>
<th>Date</th><th>Prayer</th><th>Mindset</th><th>Prioritize</th><th>Visualize</th><th>Exercise</th><th>Tracking</th><th>Habit Slips</th><th>Job Hours</th><th>Impact Hours</th><th>Score</th>
</tr>
</thead>
<tbody id="dailyBody"></tbody>
</table>
</section>

<!-- TOP 3 -->
<section class="card">
<h2>Top 3</h2>
<div style="text-align:center;">
<input type="text" id="taskInput" placeholder="Enter task">
<button id="addTaskBtn">Add Task</button>
<button id="resetTasksBtn">Reset</button>
</div>
<div id="taskList" style="text-align:center;"></div>
</section>

<!-- HABIT BREAKING -->
<section class="card">
<h2>Habit Breaking</h2>
<div style="text-align:center;">
<input type="text" id="habitInput" placeholder="Enter habit">
<button id="addHabitBtn">Add Habit</button>
</div>
<div id="habitList" style="text-align:center;"></div>
</section>

<!-- TIMERS -->
<section class="card">
<h2>Timers</h2>
<p>Job Hours: <span id="jobTime">0h 0m 0s</span> 
<button id="startJobBtn">Start</button> 
<button id="stopJobBtn">Stop</button></p>
<p>Impact Hours: <span id="impactTime">0h 0m 0s</span> 
<button id="startImpactBtn">Start</button> 
<button id="stopImpactBtn">Stop</button></p>
</section>

<!-- CHARTS -->
<section class="card">
<h2>Daily Score Chart</h2>
<canvas id="dailyScoreChart"></canvas>
<h2>Weekly Bar Chart</h2>
<canvas id="weeklyBarChart"></canvas>
<h2>Monthly Line Chart</h2>
<canvas id="monthlyLineChart"></canvas>
<h2>Point Distribution</h2>
<canvas id="pieChart"></canvas>
</section>

<script>
  // --- Firebase Init ---
  const firebaseConfig = {
    apiKey: "AIzaSyD4IYJo_cNRILK3KmmDExpmuO7F4c_izN4",
    authDomain: "growth-tracker-a367c.firebaseapp.com",
    projectId: "growth-tracker-a367c",
    storageBucket: "growth-tracker-a367c.firebasestorage.app",
    messagingSenderId: "277469925642",
    appId: "1:277469925642:web:f79c6f277931c969bfaaf3",
    measurementId: "G-DPYPWBMHLB"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // --- State ---
  let dailyRows={}, tasks=[], habits=[], jobSeconds=0, impactSeconds=0;
  let jobInterval=null, impactInterval=null;
  let dailyChart=null, weeklyChart=null, monthlyChart=null, pieChart=null;

  function getLocalDate(){
    const today = new Date();
    return today.getFullYear() + "-" + String(today.getMonth()+1).padStart(2,'0') + "-" + String(today.getDate()).padStart(2,'0');
  }

  function formatTime(sec){
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = sec%60;
    return `${h}h ${m}m ${s}s`;
  }

  function calculateScore(row){
    return (row.prayer?1:0)+(row.mindset?1:0)+(row.prioritize?1:0)+(row.visualize?1:0)+
           (row.exercise?3:0)+(row.tracking?3:0)-row.habitSlips+row.jobHours+row.impactHours*3;
  }

  // --- Auth ---
  auth.onAuthStateChanged(async user=>{
    if(user){
      document.getElementById("login-card").style.display="none";
      document.getElementById("app").style.display="block";

      await loadData(user.uid);
    } else {
      document.getElementById("login-card").style.display="block";
      document.getElementById("app").style.display="none";
    }
  });

  document.getElementById("loginBtn").onclick = async ()=>{
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try{ await auth.signInWithEmailAndPassword(email,password);}
    catch(e){ document.getElementById("loginError").innerText=e.message;}
  }

  document.getElementById("signupBtn").onclick = async ()=>{
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try{ await auth.createUserWithEmailAndPassword(email,password); alert("Signup successful!");}
    catch(e){ document.getElementById("loginError").innerText=e.message;}
  }

  document.getElementById("logoutBtn").onclick = ()=>{ auth.signOut(); }

  // --- Load user data ---
  async function loadData(uid){
    dailyRows={};
    tasks=[]; habits=[]; jobSeconds=0; impactSeconds=0;
    
    // Daily rows
    const dailySnap = await db.collection("users").doc(uid).collection("dailyRows").get();
    dailySnap.forEach(doc=>{ dailyRows[doc.id]=doc.data(); });

    const today = getLocalDate();
    if(!dailyRows[today]){
      dailyRows[today]={date:today, prayer:false, mindset:false, prioritize:false, visualize:false, exercise:false, tracking:false, habitSlips:0, jobHours:0, impactHours:0};
      await db.collection("users").doc(uid).collection("dailyRows").doc(today).set(dailyRows[today]);
    }

    // Tasks
    const taskDoc = await db.collection("users").doc(uid).collection("meta").doc("tasks").get();
    tasks = taskDoc.exists ? taskDoc.data().tasks||[] : [];

    // Habits
    const habitDoc = await db.collection("users").doc(uid).collection("meta").doc("habits").get();
    habits = habitDoc.exists ? habitDoc.data().habits||[] : [];

    // Timers
    const timerDoc = await db.collection("users").doc(uid).collection("meta").doc("timers").get();
    if(timerDoc.exists){ jobSeconds = timerDoc.data().jobSeconds||0; impactSeconds = timerDoc.data().impactSeconds||0; }

    renderAllRows();
    renderTasks();
    renderHabits();
    startTimers();
    renderCharts();
  }

  // --- Add Today row ---
  document.getElementById("addDayBtn").onclick = async ()=>{
    const uid = auth.currentUser.uid;
    const today = getLocalDate();
    if(dailyRows[today]) return;
    dailyRows[today]={date:today, prayer:false, mindset:false, prioritize:false, visualize:false, exercise:false, tracking:false, habitSlips:0, jobHours:0, impactHours:0};
    await db.collection("users").doc(uid).collection("dailyRows").doc(today).set(dailyRows[today]);
    renderAllRows();
  }

  // --- The rest of the JS logic ---
  // Functions: renderAllRows, toggleCheck, addTask, resetTasks, addHabit, deleteHabit, startTimers, stopTimers, renderCharts
  // Implement according to the last fully working JS you had, making sure all Firestore reads/writes go through the CDN-style calls.

</script>
</body>
</html>
