<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Growth Tracker</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
<style>
body { font-family: Arial, sans-serif; text-align: center; background: #f7f9fc; margin: 0; padding: 0; }
.card { background: white; border-radius: 12px; padding: 20px; margin: 20px auto; width: 90%; max-width: 900px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
h2 { margin-top: 0; color: #333; }
button { padding: 8px 14px; border: none; border-radius: 6px; background: #4CAF50; color: white; cursor: pointer; margin: 5px; }
button:hover { background: #45a049; }
input[type="text"], input[type="email"], input[type="password"], input[type="number"] { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 6px; width: 90%; max-width: 300px; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
th { background: #4CAF50; color: white; }
.habit { display: flex; justify-content: space-between; align-items:center; margin: 5px 0; }
</style>
</head>
<body>

<div id="login-card" class="card">
<h2>Login / Signup</h2>
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button id="loginBtn">Login</button>
<button id="signupBtn">Sign Up</button>
<p id="loginError" style="color:red;"></p>
</div>

<div id="app" style="display:none;">
<button id="logoutBtn" style="float:right; margin-right:20px;">Logout</button>

<div class="card">
<h2>Daily Tracker</h2>
<button id="addDayBtn">Add Today</button>
<table id="dailyTable">
<thead>
<tr>
<th>Date</th>
<th>Prayer</th>
<th>Mindset</th>
<th>Prioritize</th>
<th>Visualize</th>
<th>Exercise</th>
<th>Tracking</th>
<th>Habit Slips</th>
<th>Job Hours</th>
<th>Impact Hours</th>
<th>Daily Score</th>
</tr>
</thead>
<tbody id="dailyBody"></tbody>
</table>
</div>

<div class="card">
<h2>Prioritization Checklist</h2>
<div id="taskList"></div>
<input type="text" id="taskInput" placeholder="New Task">
<button id="addTaskBtn">Add Task</button>
<button id="resetTasksBtn">Reset Tasks</button>
</div>

<div class="card">
<h2>Habit Breaking</h2>
<input type="text" id="habitInput" placeholder="New Habit">
<button id="addHabitBtn">Add Habit</button>
<div id="habitList"></div>
</div>

<div class="card">
<h2>Timers</h2>
<div>
<button id="startJobBtn">Start Job</button>
<button id="stopJobBtn">Stop Job</button>
<span id="jobTime">0h</span>
</div>
<div>
<button id="startImpactBtn">Start Impact</button>
<button id="stopImpactBtn">Stop Impact</button>
<span id="impactTime">0h</span>
</div>
</div>

<div class="card">
<h2>Levels & Weekly Progress</h2>
<p id="levelDisplay">Level: 1</p>
<p id="weeklyScore">Weekly Score: 0</p>
<p id="streakDisplay">Progress Toward Next Level: 0/4 weeks</p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyD4IYJo_cNRILK3KmmDExpmuO7F4c_izN4",
authDomain: "growth-tracker-a367c.firebaseapp.com",
projectId: "growth-tracker-a367c",
storageBucket: "growth-tracker-a367c.firebasestorage.app",
messagingSenderId: "277469925642",
appId: "1:277469925642:web:f79c6f277931c969bfaaf3",
measurementId: "G-DPYPWBMHLB"
};

const appFirebase = initializeApp(firebaseConfig);
const auth = getAuth(appFirebase);

const loginCard = document.getElementById("login-card");
const appDiv = document.getElementById("app");
const loginError = document.getElementById("loginError");

// Track state
let dailyRows={}, weeklyPoints=0, currentLevel=1, streak=0;
let jobMinutes=0, impactMinutes=0, jobInterval, impactInterval;
let tasks=[], habits=[];

onAuthStateChanged(auth,user=>{
  if(user){ loginCard.style.display="none"; appDiv.style.display="block"; }
  else{ loginCard.style.display="block"; appDiv.style.display="none"; }
});

// --- Login / Signup ---
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  loginError.innerText="";
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  try { await signInWithEmailAndPassword(auth,email,password); console.log("Login success", email); }
  catch(e){ loginError.innerText=`Login failed: ${e.message}`; console.error(e); }
});

document.getElementById("signupBtn").addEventListener("click", async ()=>{
  loginError.innerText="";
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  try { await createUserWithEmailAndPassword(auth,email,password); alert("Signup successful! You can now login."); console.log("Signup success", email); }
  catch(e){ loginError.innerText=`Signup failed: ${e.message}`; console.error(e); }
});

// --- Logout ---
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
});

// --- Daily Tracker ---
const addDayBtn = document.getElementById("addDayBtn");
addDayBtn.addEventListener("click", addDay);

function addDay(){
  const today = new Date().toISOString().split("T")[0];
  if(dailyRows[today]){ alert("Today's row already exists"); return; }
  const row = { date:today, prayer:false, mindset:false, prioritize:false, visualize:false, exercise:false, tracking:false, habitSlips:0, jobHours:0, impactHours:0 };
  dailyRows[today]=row;
  renderRow(row);
}

function renderRow(row){
  const tbody = document.getElementById("dailyBody");
  const tr = document.createElement("tr");
  tr.id = "row_"+row.date;
  tr.innerHTML = `
<td>${row.date}</td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','prayer')"></td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','mindset')"></td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','prioritize')"></td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','visualize')"></td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','exercise')"></td>
<td><input type="checkbox" onchange="toggleCheck('${row.date}','tracking')"></td>
<td id="habitSlips_${row.date}">0</td>
<td id="jobHours_${row.date}">0</td>
<td id="impactHours_${row.date}">0</td>
<td id="dailyScore_${row.date}">0</td>`;
  tbody.appendChild(tr);
}

// --- Updated toggleCheck for auto-tracking ---
window.toggleCheck = function(date, field){
  const row = dailyRows[date];
  row[field] = !row[field];

  // Automatically check 'tracking' if any checkbox except tracking itself is clicked
  if(field !== "tracking") row.tracking = true;

  // Update tracking checkbox UI
  const tr = document.getElementById("row_" + date);
  tr.querySelectorAll("td")[6].querySelector("input").checked = row.tracking;

  updateScore(date);
};

// --- Scoring & Level ---
function updateScore(date){
  const row = dailyRows[date];
  let score = 0;
  if(row.prayer) score+=1;
  if(row.mindset) score+=1;
  if(row.prioritize) score+=1;
  if(row.visualize) score+=1;
  if(row.exercise) score+=3;
  if(row.tracking) score+=3;
  score -= row.habitSlips;
  score += row.jobHours;
  score += row.impactHours*3;
  document.getElementById("dailyScore_"+date).innerText = score;

  weeklyPoints=0;
  for(const d in dailyRows){ weeklyPoints+=calculateScore(dailyRows[d]); }
  document.getElementById("weeklyScore").innerText = "Weekly Score: "+weeklyPoints;

  // Level progression
  let nextMin=0,nextMax=0;
  if(currentLevel===1){nextMin=112;nextMax=125;}
  if(currentLevel===2){nextMin=126;nextMax=140;}
  if(currentLevel===3){nextMin=141;nextMax=170;}
  if(weeklyPoints>=nextMin && weeklyPoints<=nextMax){ streak++; if(streak>=4){currentLevel++; streak=0;} }
  else{ streak=0; }
  document.getElementById("levelDisplay").innerText = "Level: "+currentLevel;
  document.getElementById("streakDisplay").innerText = "Progress Toward Next Level: "+streak+"/4 weeks";
}

function calculateScore(row){ return row.prayer+row.mindset+row.prioritize+row.visualize+row.exercise*3+row.tracking*3-row.habitSlips+row.jobHours+row.impactHours*3; }

// --- Timers ---
document.getElementById("startJobBtn").addEventListener("click", ()=>startTimer('job'));
document.getElementById("stopJobBtn").addEventListener("click", ()=>stopTimer('job'));
document.getElementById("startImpactBtn").addEventListener("click", ()=>startTimer('impact'));
document.getElementById("stopImpactBtn").addEventListener("click", ()=>stopTimer('impact'));

function startTimer(type){
  if(type==="job" && !jobInterval){ jobInterval=setInterval(()=>{jobMinutes++; document.getElementById("jobTime").innerText=Math.floor(jobMinutes/60)+"h"; },1000*60); }
  if(type==="impact" && !impactInterval){ impactInterval=setInterval(()=>{impactMinutes++; document.getElementById("impactTime").innerText=Math.floor(impactMinutes/60)+"h"; },1000*60); }
}
function stopTimer(type){
  if(type==="job"){ clearInterval(jobInterval); jobInterval=null; const lastDate=Object.keys(dailyRows).slice(-1)[0]; if(lastDate){ dailyRows[lastDate].jobHours=Math.floor(jobMinutes/60); updateScore(lastDate); } }
  if(type==="impact"){ clearInterval(impactInterval); impactInterval=null; const lastDate=Object.keys(dailyRows).slice(-1)[0]; if(lastDate){ dailyRows[lastDate].impactHours=Math.floor(impactMinutes/60); updateScore(lastDate); } }
}

// --- Tasks ---
const addTaskBtn = document.getElementById("addTaskBtn");
const resetTasksBtn = document.getElementById("resetTasksBtn");
addTaskBtn.addEventListener("click", addTask);
resetTasksBtn.addEventListener("click", resetTasks);

function addTask(){
  const val=document.getElementById("taskInput").value;
  if(val){ tasks.push(val); document.getElementById("taskInput").value=""; renderTasks(); updatePrioritize(); }
}
function resetTasks(){ tasks=[]; renderTasks(); updatePrioritize(); }
function renderTasks(){
  const div=document.getElementById("taskList");
  div.innerHTML="";
  tasks.forEach((t,i)=>{
    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.addEventListener("change", ()=>updatePrioritize());
    div.appendChild(cb);
    div.appendChild(document.createTextNode(t));
    div.appendChild(document.createElement("br"));
  });
}
function updatePrioritize(){
  const allChecked = Array.from(document.getElementById("taskList").querySelectorAll("input[type=checkbox]")).every(c=>c.checked);
  const lastDate=Object.keys(dailyRows).slice(-1)[0];
  if(lastDate){ dailyRows[lastDate].prioritize=allChecked; document.getElementById("row_"+lastDate).querySelectorAll("td")[3].querySelector("input").checked=allChecked; updateScore(lastDate); }
}

// --- Habits ---
document.getElementById("addHabitBtn").addEventListener("click", ()=>{
  const val=document.getElementById("habitInput").value;
  if(val){ habits.push({name:val, slips:0, daysSinceLastSlip:0}); document.getElementById("habitInput").value=""; renderHabits(); }
});

function renderHabits(){
  const div = document.getElementById("habitList");
  div.innerHTML="";
  habits.forEach((h,i)=>{
    const d=document.createElement("div");
    d.className="habit";
    const nameSpan=document.createElement("span");
    nameSpan.innerText=`${h.name} - Days since last slip: ${h.daysSinceLastSlip}`;
    const slipBtn=document.createElement("button");
    slipBtn.innerText="Slip";
    slipBtn.addEventListener("click", ()=>{
      h.slips++; h.daysSinceLastSlip=0;
      const lastDate=Object.keys(dailyRows).slice(-1)[0];
      if(lastDate){ dailyRows[lastDate].habitSlips++; document.getElementById("habitSlips_"+lastDate).innerText=dailyRows[lastDate].habitSlips; updateScore(lastDate); }
      renderHabits();
    });
    const deleteBtn=document.createElement("button");
    deleteBtn.innerText="Delete";
    deleteBtn.addEventListener("click", ()=>{
      habits.splice(i,1); renderHabits();
    });
    d.appendChild(nameSpan); d.appendChild(slipBtn); d.appendChild(deleteBtn);
    div.appendChild(d);
    h.daysSinceLastSlip++;
  });
}
</script>
</body>
</html>
